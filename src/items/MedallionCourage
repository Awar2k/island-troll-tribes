function Trig_Medallion_Courage_Conditions takes nothing returns nothing
  return GetSpellAbilityId() == SPELL_SUPERSUB_COURAGE
endfunction

//===========================================================================
function Trig_Medallion_Courage_Actions takes nothing returns nothing
  local unit COURAGEOUS_UNIT = GetSpellAbilityUnit()
  local integer UNIT_TYPE = GetUnitTypeId(COURAGEOUS_UNIT)
  local integer MEDAL_EU = 0

  if UNIT_TYPE == UNIT_GATHERER then
    if GetUnitAbilityLevelSwapped(ABILITY_MEU_GATHERER, COURAGEOUS_UNIT) == 0 then
      set MEDAL_EU = ABILITY_MEU_OMNIGATHERER
    endif
  elseif UNIT_TYPE == UNIT_THIEF then
    if GetUnitAbilityLevelSwapped(ABILITY_MEU_THIEF, COURAGEOUS_UNIT) == 0 then
      set MEDAL_EU = ABILITY_MEU_ASSASSIN
    endif
  elseif UNIT_TYPE == UNIT_SCOUT then
    if GetUnitAbilityLevelSwapped(ABILITY_MEU_SCOUT, COURAGEOUS_UNIT) == 0 then
      set MEDAL_EU = ABILITY_MEU_SPY
    endif
  elseif UNIT_TYPE == UNIT_MAGE then
    if GetUnitAbilityLevelSwapped(ABILITY_MEU_MAGE, COURAGEOUS_UNIT) == 0 then
      set MEDAL_EU = ABILITY_MEU_DEMENTIA_MASTER
    endif
  elseif UNIT_TYPE == UNIT_PRIEST then
    if GetUnitAbilityLevelSwapped(ABILITY_MEU_PRIEST, COURAGEOUS_UNIT) == 0 then
      set MEDAL_EU = ABILITY_MEU_SAGE
    endif
  endif

  if MEDAL_EU != 0 then
    call removeItem(COURAGEOUS_UNIT, ITEM_MEDALLION_COURAGE)
    call SetPlayerAbilityAvailableBJ( false, MEDAL_EU, GetOwningPlayer(COURAGEOUS_UNIT) )
    call UnitAddAbilityBJ( MEDAL_EU, COURAGEOUS_UNIT )
  endif

  set COURAGEOUS_UNIT = null
endfunction

//===========================================================================
function InitTrig_Medallion_Courage takes nothing returns nothing
    set gg_trg_Medallion_Courage = CreateTrigger()
    call TriggerRegisterAnyUnitEventBJ(medallionTrigger, EVENT_PLAYER_UNIT_SPELL_CAST)
    call TriggerAddCondition( gg_trg_Medallion_Courage, Condition(function Trig_Medallion_Courage_Conditions ) )
    call TriggerAddAction( gg_trg_Medallion_Courage, function Trig_Medallion_Courage_Actions )
endfunction
